<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="https://github.com/letu-rebel/hi-pat/blob/main/extras/patty-plinko.ico?raw=true" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patty Plinko</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.17.1/matter.min.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        #background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://marvel-b1-cdn.bc0a.com/f00000000047992/www.letu.edu/alumni/images/academic-social/academic-social-alum-3.jpg') no-repeat center center fixed;
            background-size: cover;
            filter: blur(7px) brightness(0.65);
            z-index: -1;
        }
        #score {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(255,255,255,0.5);
            padding: 20px;
            border-radius: 20px;
            color: black;
            font-family: Arial, sans-serif;
            font-size: 48px;
            backdrop-filter: blur(10px);
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>
    <div id="background"></div>
    <div id="score">Score: 0</div>
    <script>
        const Engine = Matter.Engine,
            Render = Matter.Render,
            World = Matter.World,
            Bodies = Matter.Bodies,
            Body = Matter.Body;

        const screen_width = window.innerWidth;
        const screen_height = window.innerHeight;
        const peg_spacing = 60;
        const peg_radius = 10;
        const ball_density = 0.0001;

        const engine = Engine.create();
        engine.world.gravity.y = .4;
        engine.world.gravity.x = 0;

        const render = Render.create({
            element: document.body,
            engine: engine,
            options: {
                width: screen_width,
                height: screen_height,
                wireframes: false,
                background: 'transparent'
            }
        });

        Engine.run(engine);
        Render.run(render);

        let score = 0;

        function createPegs() {
            let rows = (screen_height - 50) / peg_spacing;
            let cols = screen_width / peg_spacing;
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    let offset = (peg_radius + peg_spacing / 2) * (row % 2);
                    let x = col * peg_spacing + peg_radius + offset;
                    let y = row * peg_spacing + peg_radius + 50;
                    let peg = Bodies.circle(x, y, peg_radius, {
                        isStatic: true,
                        render: { fillStyle: '#333' }
                    });
                    World.add(engine.world, peg);
                }
            }
        }

        function spawnBall() {
            let radius = 16;
            let x = Math.random() * (screen_width - radius * 2) + radius;
            let y = -radius;
            let imageURL = "https://github.com/letu-rebel/hi-pat/blob/main/maysmoments/lil_mays.png?raw=true";

            return Bodies.circle(x, y, radius, {
                restitution: 0.9,
                friction: .005,
                render: {
                    sprite: {
                        texture: imageURL,
                        xScale: .5,
                        yScale: .5
                    }
                }
            });
        }

        const platform = Bodies.rectangle(screen_width / 2, screen_height - 20, 150, 10, {
            isStatic: false,
            render: { fillStyle: '#555' }
        });
        World.add(engine.world, platform);

        createPegs();

        let balls = [];
        for (let i = 0; i < Math.floor(screen_width * screen_height * ball_density); i++) {
            balls[i] = spawnBall();
            World.add(engine.world, balls[i]);
        }

        Matter.Events.on(engine, 'afterUpdate', function() {
            balls.forEach((ball, index) => {
                if (Matter.SAT.collides(ball, platform).collided) {
                    score++;
                    World.remove(engine.world, ball);
                    balls[index] = spawnBall();
                    World.add(engine.world, balls[index]);
                    document.getElementById('score').innerText = 'Score: ' + score;
                }
                if (ball.position.y > screen_height + ball.circleRadius) {
                    World.remove(engine.world, ball);
                    balls[index] = spawnBall();
                    World.add(engine.world, balls[index]);
                }
                if (ball.position.x < -ball.circleRadius) {
                    Body.setPosition(ball, { x: screen_width + ball.circleRadius, y: ball.position.y });
                }
                if (ball.position.x > screen_width + ball.circleRadius) {
                    Body.setPosition(ball, { x: -ball.circleRadius, y: ball.position.y });
                }
            });
        });

        document.addEventListener('keydown', (event) => {
            const velocity = 5;
            if (event.key === 'ArrowLeft') {
                Body.setVelocity(platform, { x: -velocity, y: 0 });
            } else if (event.key === 'ArrowRight') {
                Body.setVelocity(platform, { x: velocity, y: 0 });
            }
        });

        window.addEventListener('resize', function() {
            location.reload();
        });
    </script>
</body>
</html>
